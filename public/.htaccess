RewriteEngine On

# Wiki preview (must come before article rules)
RewriteRule ^wiki/preview/?$ /modules/wiki/preview.php [L,QSA]

# Wiki pretty URLs
# /wiki/article-name -> /modules/wiki/article.php?slug=article-name
RewriteRule ^wiki/([a-zA-Z0-9\-_]+)/?$ /modules/wiki/article.php?slug=$1 [L,QSA]

# /wiki/article-name/history -> /modules/wiki/history.php?slug=article-name
RewriteRule ^wiki/([a-zA-Z0-9\-_]+)/history/?$ /modules/wiki/history.php?slug=$1 [L,QSA]

# /wiki/article-name/talk -> /modules/wiki/talk.php?slug=article-name
RewriteRule ^wiki/([a-zA-Z0-9\-_]+)/talk/?$ /modules/wiki/talk.php?slug=$1 [L,QSA]

# /wiki/article-name/edit -> /pages/wiki/edit_article.php?slug=article-name
RewriteRule ^wiki/([a-zA-Z0-9\-_]+)/edit/?$ /pages/wiki/edit_article.php?slug=$1 [L,QSA]

# Special pages
RewriteRule ^wiki/special/([a-zA-Z0-9\-_]+)/?$ /modules/wiki/special/$1.php [L,QSA]

# Category pages
RewriteRule ^wiki/category/([a-zA-Z0-9\-]+)/?$ /modules/wiki/category.php?slug=$1 [L,QSA]

# Default wiki index - redirect to Main_Page
RewriteRule ^wiki/?$ /wiki/Main_Page [R=301,L]

# Wiki management pages
RewriteRule ^wiki/upload/?$ /pages/wiki/upload_file.php [L,QSA]
RewriteRule ^wiki/manage/redirects/?$ /pages/wiki/manage_redirects.php [L,QSA]
RewriteRule ^wiki/manage/files/?$ /pages/wiki/manage_files.php [L,QSA]

# Auth pages
RewriteRule ^login/?$ /pages/auth/login.php [L,QSA]
RewriteRule ^register/?$ /pages/auth/register.php [L,QSA]
RewriteRule ^logout/?$ /logout.php [L,QSA]

# User pages
RewriteRule ^dashboard/?$ /pages/user/dashboard.php [L,QSA]
RewriteRule ^settings/?$ /pages/user/settings.php [L,QSA]
RewriteRule ^profile/?$ /pages/user/profile.php [L,QSA]
RewriteRule ^user/([a-zA-Z0-9\-_]+)/?$ /pages/user/user_profile.php?username=$1 [L,QSA]

# Search pages
RewriteRule ^search/advanced/?$ /search/advanced.php [L,QSA]

# API endpoints
RewriteRule ^api/ajax/search_suggestions/?$ /api/ajax/search_suggestions.php [L,QSA]

# Social pages
RewriteRule ^friends/?$ /pages/social/friends.php [L,QSA]
RewriteRule ^friends/requests/?$ /modules/friends/requests.php [L,QSA]
RewriteRule ^friends/suggestions/?$ /modules/friends/suggestions.php [L,QSA]
RewriteRule ^friends/lists/?$ /modules/friends/lists.php [L,QSA]
RewriteRule ^friends/all/?$ /modules/friends/all.php [L,QSA]
RewriteRule ^create_post/?$ /pages/social/create_post.php [L,QSA]
RewriteRule ^messages/?$ /pages/social/messages.php [L,QSA]

# Admin pages
RewriteRule ^admin/?$ /pages/admin/admin.php [L,QSA]

# Handle trailing slashes
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)/$ /$1 [R=301,L]
